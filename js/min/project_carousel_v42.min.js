!function(t,e,n){var a={multiple:3,lang:"en",renderTarget:e(".cwsCarousel"),carouselContent:"",carouselUiContent:"",carouselContainer:"",carouselBuffer:"",carouselContentLength:"",contentIndex:0,bCalledByUi:!1,bHasCssTransforms:!1,History:t.History,pageTitle:document.title,startItem:0,newMultiple:"",showPage:function(t,a,i,s){function l(){o.contentIndex<o.carouselContentLength?e(".cwsCnext").removeClass("disabled").attr("title",o.carouselContent.i18n.uInext):e(".cwsCnext").addClass("disabled").attr("title",""),o.contentIndex<=o.multiple?e(".cwsCprev").addClass("disabled").attr("title",""):e(".cwsCprev").removeClass("disabled").attr("title",o.carouselContent.i18n.uIprevious)}this.bCalledByUi=i,a!==n&&(this.contentIndex=a),"back"===t&&(this.contentIndex=this.contentIndex-2*this.multiple);var o=this;this.carouselContainer.fadeTo(500,0,function(){function e(t,e){null!==t&&alert("dust error: "+t),o.carouselBuffer+=e}s!==n&&o.carouselContainer.removeClass("multiple1 multiple2 multiple3 multiple4").addClass("multiple"+s),o.carouselContainer.empty().removeClass("forward back enterLeft enterRight"),o.carouselBuffer="";for(var a=0;a<o.multiple;a++){if(o.contentIndex<o.carouselContentLength){var i=o.carouselContent.projects[o.contentIndex],r=o.carouselUiContent,c=dust.makeBase(r);c=c.push(i),dust.render("cwsProjects",c,e)}o.contentIndex++}var u="enterLeft";"back"===t&&(u="enterRight"),o.carouselContainer.html(o.carouselBuffer).addClass(u),l();var d=o.contentIndex/o.multiple;o.bCalledByUi===!0&&(o.History.pushState({state:o.contentIndex,rand:Math.random()},o.pageTitle+" - Page "+d,"?page="+d+"+multiple="+o.multiple+"+lang="+o.lang),o.bCalledByUi=!1),o.carouselContainer.fadeTo(500,1)})},markMultiple:function(t){var n=e("#setMultipleControl");n.find("li").removeClass("active"),n.find("li:eq("+--t+")").addClass("active")},setMultiple:function(t){this.multiple=t,this.markMultiple(t),this.showPage("forward",0,!0,t)},markLang:function(t){var n=e("#setLangControl");n.find("li").removeClass("active"),n.find("#"+t).addClass("active")},setLang:function(t){this.lang=t,this.carouselContainer.fadeTo(700,0,function(){a.loadData(1),a.markLang(a.lang)})},buildUI:function(i){var s='<section id="controls"><section id="setMultipleControl"><h4>'+this.carouselContent.i18n.uImultiItems+':</h4><ul><li>1</li><li>2</li><li>3</li><li>4</li></ul></section><section id="setLangControl"><h4>'+this.carouselContent.i18n.uImultiLang+':</h4><ul><li id="en">'+this.carouselContent.i18n.localeNames.uIen+'</li><li id="fr">'+this.carouselContent.i18n.localeNames.uIfr+"</li></ul></section></section>",l='<a href="#" class="cwsCprev" title="'+this.carouselContent.i18n.uIprevious+'">'+this.carouselContent.i18n.uIprevious+'</a> <a href="#" class="cwsCnext" title="'+this.carouselContent.i18n.uInext+'">'+this.carouselContent.i18n.uInext+'</a><div class="carousel multiple'+a.multiple+'"></div>';this.renderTarget.html(s+l),this.carouselContainer=this.renderTarget.children(".carousel"),i?(i=0,this.showPage(n,a.contentIndex-a.multiple,!0,n)):(this.renderTarget.on("click",".cwsCprev, .cwsCnext",function(t){if(!e(this).hasClass("disabled")){var i="forward";if(e(this).hasClass("cwsCprev")&&(i="back"),a.bHasCssTransforms){var s=0;a.carouselContainer.addClass(i).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){s++,s===a.carouselContainer.children().length&&(a.carouselContainer.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),a.showPage(i,n,!0,n))})}else a.showPage(i,n,!0,n)}t.preventDefault()}),this.renderTarget.on("click","#setMultipleControl li",function(){var t=e(this).index()+1;t!==a.multiple&&a.setMultiple(t)}),this.renderTarget.on("click","#setLangControl li",function(){var t=e(this).attr("id");t!==a.lang&&a.setLang(t)}),this.showPage("forward",this.startItem,!0,n),History.Adapter.bind(t,"statechange",function(){var t=History.getState();!a.bCalledByUi&&t.data.state>=a.multiple?a.showPage(n,t.data.state-a.multiple,!1,n):a.bCalledByUi||t.data.state||history.back()})),this.markMultiple(this.multiple),this.markLang(this.lang)},loadData:function(t){e.ajax({url:"json/cws_"+a.lang+".json",dataType:"json",cache:!1,success:function(e){a.carouselContent=e.cwsData,a.carouselUiContent=e.cwsData.i18n,a.carouselContentLength=a.carouselContent.projects.length,a.buildUI(t)},error:function(){alert("Failed to load json...")}})},init:function(){Modernizr.csstransforms&&(this.bHasCssTransforms=!0);var e=0,n="";""!==t.location.search?n=t.location.search:""!==t.location.hash&&(n=t.location.hash),""!==n&&(e=parseInt(n.split("=")[1].split("+")[0],10),this.multiple=parseInt(n.split("+multiple=")[1].split("+lang=")[0],10),this.lang=n.split("+lang=")[1].split("&")[0]),0!==e&&(this.startItem=--e*this.multiple),this.loadData(0)}};a.init()}(window,jQuery);